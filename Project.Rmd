---
title: "Testing Data"
output: html_document
date: "2023-11-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(lubridate) #for time calculations.


data_movements = read.csv("movements.csv")
data_restaurant = read.csv("restaurants.csv")

colnames(data_movements)
```

```{r}
# Create an sf data frame with restaurant coordinates
sf_movements <- st_as_sf(data_movements, coords = c("Longitude", "Latitude"), crs = 4326)

# Transform movements coordinates to UTM (assuming the same zone as restaurants)
sf_movements_utm = st_transform(sf_movements, crs = 26911)

sf_movements_utm2 <- sf_movements_utm %>%
  mutate(utm = st_coordinates(sf_movements_utm))
```

```{r}
 #update nov26

# Create an sf data frame with restaurant coordinates
sf_restaurants <- st_as_sf(data_restaurant, coords = c("Longitude", "Latitude"), crs = 4326)

# Transform movements coordinates to UTM (assuming the same zone as restaurants)
sf_restaurants_utm = st_transform(sf_restaurants, crs = 26911)

sf_restaurants_utm2 <- sf_restaurants_utm %>%
  mutate(utm = st_coordinates(sf_restaurants_utm))

```

```{r}
library(sf)
library(ggplot2)
# Function to create a buffer (radius) around a point in UTM units
create_buffer <- function(lon, lat, radius_meters) {
  # Create a data frame with the restaurant coordinates
  restaurant <- data.frame(lon = lon, lat = lat)
  
  # Create an sf (Simple Features) point object
  restaurant_sf <- st_as_sf(restaurant, coords = c("lon", "lat"), crs = 4326)
  
  # Project the point to UTM (change the UTM zone accordingly)
  restaurant_sf_utm <- st_transform(restaurant_sf, crs = 26911)  # UTM zone 33N
  
  # Create a buffer around the point in UTM units
  buffer <- st_buffer(restaurant_sf_utm, dist = radius_meters)
  
  return(buffer)
}

# Restaurant coordinates (longitude and latitude)
restaurant_lon <- data_restaurant$Longitude  # Replace with the actual longitude of the restaurant
restaurant_lat <- data_restaurant$Latitude  # Replace with the actual latitude of the restaurant

# Radius in meters
radius_meters <- 500 # Replace with the desired radius in meters

# Create a buffer around the restaurant location
buffer_utm <- create_buffer(restaurant_lon, restaurant_lat, radius_meters)

# Plot the result
plot(st_geometry(buffer_utm), main = "Radius around Restaurant (UTM)", col = "lightblue", lwd = 1)

points(x = restaurant_lon, y = restaurant_lat,col = "coral2" , pch = 16, cex = 2)  # Plot the restaurant location


```


```{r}
library(htmltools)
library(leaflet)
leaflet()%>%
  addTiles()%>%
  addMarkers(lng = data_restaurant$Longitude, lat = data_restaurant$Latitude, popup = data_restaurant$Name)
```

```{r}
# Create circles around restaurants
sf_restaurants_circles <- st_buffer(sf_restaurants, dist = radius_meters)

# Function to check if a point is inside any restaurant circle
is_inside_restaurant_circle <- function(point, circles) {
  inside <- sapply(seq_along(circles), function(i) {
    st_contains(circles[i], point)
  })
  any(inside)
}
```

```{r}
# Convert 'datetime' column to POSIXct format (date and time)
sf_movements_utm2$datetime <- as.POSIXct(data_movements$datetime, format = "%Y-%m-%d %H:%M:%S")

```

```{r}
View(sf_movements_utm)
```

```{r}

```

